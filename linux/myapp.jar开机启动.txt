#!/bin/bash
#chkconfig: 2345 50 50
#description: myapp service
#
# This is the init script for starting up the myapp-0.0.1-SNAPSHOT.jar
#

# Source function library.
. /etc/rc.d/init.d/functions
    
SERVER_PORT=8899
APP_NAME=myapp

# start and stop functions
start() {
	echo -n "Starting $APP_NAME service:"
    pids=`netstat -lnp | grep $SERVER_PORT | awk '{print $7 }'`
    pids=${pids%/*}
    if [ -n "$pids" ]; then
        echo  "$APP_NAME service already start"
    else
		nohup /usr/bin/java -jar /root/myapp/myapp-0.0.1-SNAPSHOT.jar &
    echo "$APP_NAME is succeessfully started up"
    fi
}

stop() {
	echo -n "Shutting down $APP_NAME: "
    pids=`netstat -lnp | grep $SERVER_PORT | awk '{print $7 }'`
    pids=${pids%/*}
    if [ -n "$pids" ]; then
    kill -9 $pids
		echo  "$APP_NAME is succeessfully stopped."
    else
		echo  "$APP_NAME service already stop"
    fi
}

status(){  
    numproc=`ps -ef | grep $APP_NAME | wc -l`
    if [ $numproc -gt 0 ]; then  
       echo "$APP_NAME is running..."
    else  
       echo "$APP_NAME is stopped."  
    fi  
}  
  
restart(){  
   stop  
   start  
}  

# See how we were called.
case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    stop        
    start
    ;;
  *)
   echo $"Usage: $0 {start|stop|status|restart}"
   exit 1
esac